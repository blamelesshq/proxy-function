### Splunk Proxy Function (Azure)
Serverless Function that accepts HTTP GET requests on route "/api/fetch".
Proxy function is pinging Splunk server using [Splunk Rest API](https://docs.splunk.com/Documentation/Splunk/8.2.2/RESTREF/RESTprolog) and if successful returning back Prometheus format like metrics back to the client.
As a query parameter Function accepts:
- api_path (default one should be /services/search/jobs). This is [Splunk API jobs api path](https://docs.splunk.com/Documentation/Splunk/8.2.2/RESTREF/RESTsearch#search.2Fjobs). If this is going to be updated by Splunk end user just need to update this query parameter
- start (start time for job to look for) -> Format example: 2021-10-06T13:01:33 (YYYY-MM-DDTHH:MM:SS)
- end (end time for job to look for) -> Format example: 2021-10-06T13:01:33 (YYYY-MM-DDTHH:MM:SS)
- search (Splunk query) -> Example: 
```search host="jgalley" index="wt_events" payload.status=200 payload.uri="/owners/*" | rename payload.latency AS blvalue, _time AS bltime | fields bltime blvalue```
where fields section is optional (if it is not specified function appends it). However all other sections are required in order for function to work.

Example of the successful request/response:

- Request:
``` HTTP GET {{baseUrl}}/api/fetch?api_path=/services/search/jobs&start=2021-10-06T13:01:33&end=2021-10-15T23:05:36&search=search host="jgalley" index="wt_events" payload.status=200 payload.uri="/owners/*" | rename payload.latency AS blvalue, _time AS bltime | fields bltime blvalue ``` Where {{baseUrl}} is function host name, bltime (or blameless time) is the current timestamp, bvalue (or blameless value) is the metric value

- Response: 
```{
    "data": {
        "result": [
            {
                "metric": {},
                "values": [
                    [
                        1634306285,
                        "11"
                    ],
                    [
                        1634306285,
                        "7"
                    ],
                    [
                        1634306284,
                        "80"
                    ],
                    [
                        1634306278,
                        "76"
                    ],
                    [
                        1634306275,
                        "13"
                    ],
                    [
                        1634306275,
                        "6"
                    ],
                    [
                        1634306275,
                        "11"
                    ],
                    [
                        1634306275,
                        "12"
                    ],
                    [
                        1634306275,
                        "11"
                    ],
                    [
                        1634306275,
                        "17"
                    ],
                    [
                        1634306275,
                        "12"
                    ],
                    [
                        1634306273,
                        "86"
                    ],
                    [
                        1634305794,
                        "13"
                    ],
                    [
                        1634305794,
                        "6"
                    ],
                    [
                        1634305794,
                        "11"
                    ],
                    [
                        1634305791,
                        "19"
                    ],
                    [
                        1634305791,
                        "11"
                    ],
                    [
                        1634305791,
                        "9"
                    ],
                    [
                        1634305791,
                        "12"
                    ],
                    [
                        1634305791,
                        "11"
                    ],
                    [
                        1634305791,
                        "7"
                    ],
                    [
                        1634305791,
                        "11"
                    ],
                    [
                        1634305791,
                        "11"
                    ],
                    [
                        1634305791,
                        "19"
                    ],
                    [
                        1634305788,
                        "11"
                    ],
                    [
                        1634305788,
                        "11"
                    ],
                    [
                        1634305788,
                        "13"
                    ],
                    [
                        1634305788,
                        "11"
                    ],
                    [
                        1634305788,
                        "14"
                    ],
                    [
                        1634305788,
                        "12"
                    ],
                    [
                        1634305785,
                        "76"
                    ],
                    [
                        1634305018,
                        "12"
                    ],
                    [
                        1634305018,
                        "11"
                    ],
                    [
                        1634305015,
                        "78"
                    ],
                    [
                        1634304962,
                        "79"
                    ],
                    [
                        1634304952,
                        "75"
                    ],
                    [
                        1634304940,
                        "73"
                    ],
                    [
                        1634304931,
                        "7"
                    ],
                    [
                        1634300256,
                        "79"
                    ],
                    [
                        1634300236,
                        "78"
                    ],
                    [
                        1634229004,
                        "12"
                    ],
                    [
                        1634229004,
                        "11"
                    ],
                    [
                        1634229004,
                        "11"
                    ],
                    [
                        1634229004,
                        "79"
                    ],
                    [
                        1634229004,
                        "19"
                    ],
                    [
                        1634229001,
                        "12"
                    ],
                    [
                        1634229001,
                        "17"
                    ],
                    [
                        1634228998,
                        "78"
                    ],
                    [
                        1634228992,
                        "19"
                    ],
                    [
                        1634228991,
                        "84"
                    ],
                    [
                        1634228467,
                        "13"
                    ],
                    [
                        1634228467,
                        "12"
                    ],
                    [
                        1634228466,
                        "11"
                    ],
                    [
                        1634228466,
                        "11"
                    ],
                    [
                        1634228466,
                        "11"
                    ],
                    [
                        1634228466,
                        "13"
                    ],
                    [
                        1634228466,
                        "87"
                    ],
                    [
                        1634228462,
                        "8"
                    ],
                    [
                        1634227840,
                        "18"
                    ],
                    [
                        1634227838,
                        "11"
                    ],
                    [
                        1634227837,
                        "81"
                    ],
                    [
                        1634227746,
                        "11"
                    ],
                    [
                        1634227746,
                        "7"
                    ],
                    [
                        1634227743,
                        "13"
                    ],
                    [
                        1634227743,
                        "81"
                    ],
                    [
                        1634227743,
                        "14"
                    ],
                    [
                        1634227740,
                        "11"
                    ],
                    [
                        1634227736,
                        "86"
                    ],
                    [
                        1634227727,
                        "79"
                    ],
                    [
                        1634227724,
                        "16"
                    ],
                    [
                        1634227721,
                        "85"
                    ],
                    [
                        1634227713,
                        "19"
                    ],
                    [
                        1634226292,
                        "11"
                    ],
                    [
                        1634226292,
                        "16"
                    ],
                    [
                        1634226292,
                        "11"
                    ],
                    [
                        1634226292,
                        "9"
                    ],
                    [
                        1634226140,
                        "18"
                    ],
                    [
                        1634226140,
                        "11"
                    ],
                    [
                        1634226140,
                        "12"
                    ],
                    [
                        1634226140,
                        "19"
                    ],
                    [
                        1634226140,
                        "12"
                    ],
                    [
                        1634225957,
                        "11"
                    ],
                    [
                        1634225957,
                        "80"
                    ],
                    [
                        1634168853,
                        "12"
                    ],
                    [
                        1634168853,
                        "11"
                    ],
                    [
                        1634168853,
                        "11"
                    ],
                    [
                        1634168853,
                        "13"
                    ],
                    [
                        1634168852,
                        "85"
                    ],
                    [
                        1634137031,
                        "12"
                    ],
                    [
                        1634137031,
                        "87"
                    ],
                    [
                        1634137031,
                        "12"
                    ],
                    [
                        1634137031,
                        "11"
                    ],
                    [
                        1634137028,
                        "14"
                    ],
                    [
                        1634136953,
                        "9"
                    ],
                    [
                        1634136953,
                        "14"
                    ],
                    [
                        1634136953,
                        "6"
                    ],
                    [
                        1634136953,
                        "6"
                    ],
                    [
                        1634136953,
                        "11"
                    ],
                    [
                        1634136953,
                        "12"
                    ],
                    [
                        1634136953,
                        "21"
                    ]
                ]
            }
        ],
        "resultType": "matrix"
    },
    "status": "success"
} 
```
